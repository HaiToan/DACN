name: Deploy Frontend

on:
  push:
    branches:
      - main
    paths:
      # Vì package.json ở ngoài, nên theo dõi cả file root và folder frontend
      - 'frontend/**'
      - 'src/**'        # Nếu source code FE của bạn nằm ở src
      - 'package.json'
      - 'package-lock.json'

jobs:
  web-deploy:
    name: Deploy FE to Hosting 1
    runs-on: ubuntu-latest
    steps:
      - name: Get latest code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18' # Hoặc version bạn đang dùng
      
      # Bước này chạy ngay tại thư mục gốc vì package.json nằm ở gốc
      - name: Install and Build
        run: |
          npm install
          npm run build
      
      - name: Sync files via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FE_FTP_SERVER }}
          username: ${{ secrets.FE_FTP_USERNAME }}
          password: ${{ secrets.FE_FTP_PASSWORD }}
          # QUAN TRỌNG: Kiểm tra xem folder build ra tên là 'dist' hay 'build'
          local-dir: ./dist/ 
          server-dir: ./public_html/ 
          protocol: ftp # Hoặc ftps
          dangerous-clean-slate: true # Xóa code cũ trên host để tránh xung đột file
